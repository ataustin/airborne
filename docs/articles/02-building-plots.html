<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Creating plots • flyover</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Creating plots">
<meta property="og:description" content="flyover">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flyover</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01-preparing-data.html">Optional data preparation</a>
    </li>
    <li>
      <a href="../articles/02-building-plots.html">Creating plots</a>
    </li>
    <li>
      <a href="../articles/03-building-displays.html">Creating displays</a>
    </li>
    <li>
      <a href="../articles/04-custom-plots.html">Using custom plots</a>
    </li>
    <li>
      <a href="../articles/05-monitoring-data.html">Monitoring data drift</a>
    </li>
    <li>
      <a href="../articles/06-gallery.html">Gallery</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ataustin/flyover/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Creating plots</h1>
            
            <h4 class="date">2020-12-31</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ataustin/flyover/blob/master/vignettes/02-building-plots.Rmd"><code>vignettes/02-building-plots.Rmd</code></a></small>
      <div class="hidden name"><code>02-building-plots.Rmd</code></div>

    </div>

    
    
<div id="what-this-article-covers" class="section level2">
<h2 class="hasAnchor">
<a href="#what-this-article-covers" class="anchor"></a>What this article covers</h2>
<p>A typical <code>flyover</code> workflow has the following steps:</p>
<ol style="list-style-type: decimal">
<li>Combine different data sets into a single table.</li>
<li>Apply a plotting function to the columns of the table.</li>
<li>Build a display to navigate the plots.</li>
</ol>
<p>This vignette will introduce <strong>step 2</strong>: how <code>flyover</code>’s plotting functions work and how to easily build comparison plots for different types of data.</p>
<p>This vignette assumes you have a single data set composed of data from different groups for comparison. We will show how to use that data to build a collection of plots for comparing distributions between groups.</p>
</div>
<div id="data-for-this-example" class="section level2">
<h2 class="hasAnchor">
<a href="#data-for-this-example" class="anchor"></a>Data for this example</h2>
<p>We simulate a data set with numeric and categorical variables from two different sources (called “old” and “new”). Each source has a slightly different data-generating process. Note the <code>source</code> column where these values are stored. We wish to understand the distributional differences of the other variables between these sources.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">my_data</span><span class="op">)</span></pre></div>
<pre><code>## tibble [200 × 10] (S3: tbl_df/tbl/data.frame)
##  $ source: chr [1:200] "old" "old" "old" "old" ...
##  $ norm  : num [1:200] 1.586 1.709 0.891 0.547 1.606 ...
##  $ exp   : num [1:200] 0.1772 0.0858 0.3273 0.5311 2.5615 ...
##  $ chisq : num [1:200] 4.53 6.54 4.92 3.55 2.71 ...
##  $ lnorm : num [1:200] 1.024 0.619 1.016 4.919 1.054 ...
##  $ gamma : num [1:200] 0.866 0.89 0.549 1.02 0.948 ...
##  $ alpha : chr [1:200] "c" "b" "a" "d" ...
##  $ hilo  : chr [1:200] "high" "low" "low" "low" ...
##  $ tf    : logi [1:200] TRUE FALSE TRUE TRUE FALSE TRUE ...
##  $ fruit : chr [1:200] "pear" "pear" "apple" "pear" ...</code></pre>
</div>
<div id="built-in-plotting-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#built-in-plotting-functions" class="anchor"></a>Built-in plotting functions</h2>
<p>Plotting in <code>flyover</code> comes in two flavors, numeric and categorical. The package comes with basic built-in plotting functions that operate on columns of one of these types, and ignores columns of the other type. This means you don’t have to pre-filter a data frame by the type of data that the plots will use.</p>
<ul>
<li><p><em>Numeric</em> plotting functions will keep integer and float type variables and ignore everything else.</p></li>
<li><p><em>Categorical</em> plotting functions will keep character, factor, and logical type variables and will ignore everything else.</p></li>
</ul>
<p>Currently, <code>flyover</code>’s built-in functions and the data types on which they act are:</p>
<table class="table">
<thead><tr class="header">
<th align="left">function_name</th>
<th align="left">data_type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">flyover_histogram</td>
<td align="left">numeric</td>
</tr>
<tr class="even">
<td align="left">flyover_density</td>
<td align="left">numeric</td>
</tr>
<tr class="odd">
<td align="left">flyover_binline_ridges</td>
<td align="left">numeric</td>
</tr>
<tr class="even">
<td align="left">flyover_density_ridges</td>
<td align="left">numeric</td>
</tr>
<tr class="odd">
<td align="left">flyover_bar_dodge</td>
<td align="left">categorical</td>
</tr>
<tr class="even">
<td align="left">flyover_bar_fill</td>
<td align="left">categorical</td>
</tr>
<tr class="odd">
<td align="left">flyover_na_percent</td>
<td align="left">both</td>
</tr>
<tr class="even">
<td align="left">flyover_na_count</td>
<td align="left">both</td>
</tr>
</tbody>
</table>
<p>Plotting functions ending with <code>_ridges</code> are derived from the package <code>ggridges</code> (<a href="https://cran.r-project.org/web/packages/ggridges/vignettes/introduction.html">documentation</a>). These are well suited to comparing numeric distributions through time, <em>e.g.</em> for examining data drift across data pulls occurring on regular intervals.</p>
<p>The functions titled <code>flyover_na_*</code> are for general data quality monitoring and can operate on columns of <em>both</em> numeric and categorical types. These are also best suited for monitoring data through time.</p>
<p>See examples of monitoring data drift in <a href="https://ataustin.github.io/flyover/articles/05-monitoring-data.html">this article</a>.</p>
</div>
<div id="building-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#building-plots" class="anchor"></a>Building plots</h2>
<p>To build plots, you must specify at least three things:</p>
<ul>
<li>a data frame or similar object (such as a <code>tibble</code> or <code>data.table</code>)</li>
<li>the <code>flyover</code> plotting function you wish to use</li>
<li>the name of the variable that distinguishes groups (defaults to <code>flyover_id_</code> which is the default output of <code>stack_data</code>).</li>
</ul>
<p>For each variable of the type associated with your chosen plotting function, <code>flyover</code> will generate a plot. However, these plots are not printed yet; they are merely stored in a tibble until they are used to build displays.</p>
<div id="numeric-plots" class="section level3">
<h3 class="hasAnchor">
<a href="#numeric-plots" class="anchor"></a>Numeric plots</h3>
<p>As an example, suppose we wish to compare the numeric variables in our example data across the values of the group variable <code>source</code>. We are interested in histograms. Then we would build the plots in the following manner:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="va">my_histograms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_plots.html">build_plots</a></span><span class="op">(</span><span class="va">my_data</span>, <span class="va">flyover_histogram</span>, group_var <span class="op">=</span> <span class="st">"source"</span><span class="op">)</span>
<span class="va">my_histograms</span></pre></div>
<pre><code>## # A tibble: 5 x 3
##   variable plot         cogs            
##   &lt;chr&gt;    &lt;named list&gt; &lt;named list&gt;    
## 1 norm     &lt;gg&gt;         &lt;tibble [1 × 5]&gt;
## 2 exp      &lt;gg&gt;         &lt;tibble [1 × 5]&gt;
## 3 chisq    &lt;gg&gt;         &lt;tibble [1 × 5]&gt;
## 4 lnorm    &lt;gg&gt;         &lt;tibble [1 × 5]&gt;
## 5 gamma    &lt;gg&gt;         &lt;tibble [1 × 5]&gt;</code></pre>
<p>Notice that the output is a tibble having column <code>plot</code> which contains one plot for each numeric variable in the data. (See below for a discussion on the <code>cogs</code> columns.) The function does not print the plots directly at this stage. However, the individual plots can still be accessed:</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="va">my_histograms</span><span class="op">$</span><span class="va">plot</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></pre></div>
<p><img src="02-building-plots_files/figure-html/print-hist-1.png" width="700"></p>
<p>You are not limited to the default appearance of the built-in plotting functions. You can modify these plots by passing additional <code>ggplot2</code> elements as a list:</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="va">my_histograms_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_plots.html">build_plots</a></span><span class="op">(</span><span class="va">my_data</span>, <span class="va">flyover_histogram</span>, group_var <span class="op">=</span> <span class="st">"source"</span>,
                                 plot_mods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">xlab</span><span class="op">(</span><span class="st">"new X-axis label"</span><span class="op">)</span>,
                                                  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span>,
                                                  <span class="fu">scale_fill_viridis_d</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">my_histograms_mod</span><span class="op">$</span><span class="va">plot</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></pre></div>
<p><img src="02-building-plots_files/figure-html/modify-hist-1.png" width="700"></p>
</div>
<div id="categorical-plots" class="section level3">
<h3 class="hasAnchor">
<a href="#categorical-plots" class="anchor"></a>Categorical plots</h3>
<p>In a similar way, we can compare distributions of categorical variables across groups by examining their proportions using bar plots.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="va">my_bars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_plots.html">build_plots</a></span><span class="op">(</span><span class="va">my_data</span>, <span class="va">flyover_bar_fill</span>, group_var <span class="op">=</span> <span class="st">"source"</span><span class="op">)</span>
<span class="va">my_bars</span></pre></div>
<pre><code>## # A tibble: 4 x 3
##   variable plot         cogs            
##   &lt;chr&gt;    &lt;named list&gt; &lt;named list&gt;    
## 1 alpha    &lt;gg&gt;         &lt;tibble [1 × 3]&gt;
## 2 hilo     &lt;gg&gt;         &lt;tibble [1 × 3]&gt;
## 3 tf       &lt;gg&gt;         &lt;tibble [1 × 3]&gt;
## 4 fruit    &lt;gg&gt;         &lt;tibble [1 × 3]&gt;</code></pre>
<p>As before, you can view individual plots by calling them from this tibble.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="va">my_bars</span><span class="op">$</span><span class="va">plot</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></pre></div>
<p><img src="02-building-plots_files/figure-html/print-bar-1.png" width="700"></p>
</div>
</div>
<div id="cognostics" class="section level2">
<h2 class="hasAnchor">
<a href="#cognostics" class="anchor"></a>Cognostics</h2>
<p>The tibble returned by <code>build_plots</code> contains a column called <code>cogs</code> which is short for “cognostics”. You can read more about cognostics in the <code>trelliscopejs</code> <a href="https://hafen.github.io/trelliscopejs/articles/trelliscopejs.html">documentation</a>. In short, they are pieces of metadata that are associated with each plot in order to sort and filter plots. They are stored as tibbles, and for numeric plots they look like this:</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">my_histograms</span><span class="op">$</span><span class="va">cogs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></pre></div>
<pre><code>## tibble [1 × 5] (S3: tbl_df/tbl/data.frame)
##  $ pct_change_mean     : num 152
##  $ pct_change_median   : num 111
##  $ pct_change_max      : num 53.9
##  $ pct_change_min      : num 147
##  $ pct_change_n_missing: num 0</code></pre>
<p>These are summaries of features of the data used to generate the first plot. They represent the largest differences (in percentage terms) between any groups for that variable.</p>
<p>For categorical plots, the cognostics look like this:</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">my_bars</span><span class="op">$</span><span class="va">cogs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></pre></div>
<pre><code>## tibble [1 × 3] (S3: tbl_df/tbl/data.frame)
##  $ pct_change_n_missing  : num 0
##  $ pct_change_pct_missing: num 0
##  $ n_levels              : int 4</code></pre>
<p>The next article will clarify how cognostics are used in trelliscope displays.</p>
</div>
<div id="plotting-in-parallel" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-in-parallel" class="anchor"></a>Plotting in parallel</h2>
<p>If you have an unruly number of variables to plot, you can save time by creating them in parallel. On unix-like machines, you can supply an integer to the <code>ncores</code> argument to render plots across multiple cores. This uses the <code>parallel</code> package that ships with R, which means that unfortunately this feature is not supported on Windows (unless you are using Windows Subsystem for Linux).</p>
<p>For an introduction to parallel computing, see <a href="https://bookdown.org/rdpeng/rprogdatascience/parallel-computation.html">this chapter</a> in Roger Peng’s book.</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="va">my_histograms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_plots.html">build_plots</a></span><span class="op">(</span><span class="va">my_data</span>, <span class="va">flyover_histogram</span>, group_var <span class="op">=</span> <span class="st">"source"</span>,
                             ncores <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></pre></div>
</div>
<div id="using-a-pipe" class="section level2">
<h2 class="hasAnchor">
<a href="#using-a-pipe" class="anchor"></a>Using a pipe</h2>
<p>Notice that these functions – indeed, all the functions in this package – are data-first, meaning they are pipe-friendly. Thus you could in theory write a pipeline like this:</p>
<pre><code>my_histograms &lt;-
  old %&gt;%
  enlist_data(new) %&gt;%
  stack_data() %&gt;%
  build_plots(flyover_histogram)</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Adam Austin.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
